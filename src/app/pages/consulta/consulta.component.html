<div>
    <app-page-breadcrumb pageTitle="Consulta" />

    <div
        class="min-h-screen rounded-2xl border border-gray-200 bg-white px-5 py-7 dark:border-gray-800 dark:bg-white/[0.03] xl:px-10 xl:py-12">

        <div class="mx-auto w-full text-center">

            <!-- Filtros + Ações -->
            <div class="toolbar">
                <div class="filters">
                    <input class="input" type="text" placeholder="Paciente" />
                    <!-- onFiltroPaciente(($event.target as HTMLInputElement).value) -->

                    <input class="input" type="text" placeholder="Profissional" />
                    <!-- (input)="onFiltroProfissional(($event.target as HTMLInputElement).value)" -->

                    <select class="select">
                        <option value="">Todos os status</option>
                        <option value="Agendado">Agendado</option>
                        <option value="Confirmado">Confirmado</option>
                        <option value="Realizado">Realizado</option>
                        <option value="Cancelado">Cancelado</option>
                        <option value="Finalizada">Finalizada</option>
                    </select>
                    <!-- (change)="onFiltroStatus(($event.target as HTMLSelectElement).value)" -->
                </div>

                <div class="actions">
                    <button class="btn btn-success" type="button" (click)="exportarExcel()">Exportar Excel</button>
                    <button class="btn btn-danger" type="button" (click)="exportarPDF()">Exportar PDF</button>
                    <button class="btn btn-primary" type="button" (click)="novaConsulta()"> + Nova Consulta </button>
                </div>
            </div>

            <!-- Tabela -->
            @if (loading()) {
            <div>Carregando consultas…</div>
            } @else if (error()) {
            <div class="error">{{ error() }}</div>
            } @else {
            <div class="table-wrapper">
                <table class="table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Código</th>
                            <th>Paciente</th>
                            <th>Idade</th>
                            <th>Convênio</th>
                            <th>Profissional</th>
                            <th>Especialidades</th>
                            <th>Departamento</th>
                            <th>Data</th>
                            <th>Hora</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>

                    <tbody>
                        @for (c of consultasPaginadas(); track c.id; let i = $index) {
                        <tr>
                            <td>{{ (paginaAtual - 1) * pageSize + i + 1 }}</td>
                            <td>{{ c.codigo || '—' }}</td>
                            <td>{{ c.nome_paciente || '—' }}</td>
                            <td>{{ idadeDe(c.dataNascimento) }}</td>
                            <td>{{ c.convenio || '—' }}</td>
                            <td>{{ c.nome_profissional || '—' }}</td>

                            <!-- se não existir no payload, mostramos “—” -->
                            <td>{{ c.especialidades || '—' }}</td>
                            <td>{{ c.departamentos || '—' }}</td>

                            <!-- usa data do agendamento se existir, senão a da consulta -->
                            <td>{{ formatarDataBR(c.data_agendamento ) }}</td>
                            <td>{{ formatarHoraBR(c.hora) }}</td>

                            <td>{{ c.situacao }}</td>

                            <td class="acoes">
                                <button class="icon-btn" title="Editar" (click)="editar(c)">
                                    <!-- lápis -->
                                    <svg width="1em" height="1em" viewBox="0 0 21 21" fill="currentColor" xmlns="http://www.w3.org/2000/svg"
                                        class="text-gray-700 cursor-pointer size-5 hover:text-error-500 dark:text-gray-400 dark:hover:text-error-500">
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                            d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zm2.92 2.83H5v-.92l9.06-9.06.92.92L5.92 20.08zM20.71 7.04a1.003 1.003 0 0 0 0-1.42l-2.34-2.34a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z" 
                                            fill="currentColor"/>
                                            
                                    </svg>
                                </button>
                                <button class="icon-btn danger" title="Excluir" (click)="excluir(c)">
                                    <!-- lixeira -->
                                    <!-- <svg width="16" 
                                         height="16" 
                                         viewBox="0 0 24 24" 
                                         fill="currentColor"
                                         aria-hidden="true">
                                        <path d="M6 7h12v13a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V7zm12-3h-4l-1-1h-2l-1 1H6v2h12V4z" />
                                    </svg> -->
                                    <svg width="1em" height="1em" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"
                                        class="text-gray-700 cursor-pointer size-5 hover:text-error-500 dark:text-gray-400 dark:hover:text-error-500">
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                            d="M6.54142 3.7915C6.54142 2.54886 7.54878 1.5415 8.79142 1.5415H11.2081C12.4507 1.5415 13.4581 2.54886 13.4581 3.7915V4.0415H15.6252H16.666C17.0802 4.0415 17.416 4.37729 17.416 4.7915C17.416 5.20572 17.0802 5.5415 16.666 5.5415H16.3752V8.24638V13.2464V16.2082C16.3752 17.4508 15.3678 18.4582 14.1252 18.4582H5.87516C4.63252 18.4582 3.62516 17.4508 3.62516 16.2082V13.2464V8.24638V5.5415H3.3335C2.91928 5.5415 2.5835 5.20572 2.5835 4.7915C2.5835 4.37729 2.91928 4.0415 3.3335 4.0415H4.37516H6.54142V3.7915ZM14.8752 13.2464V8.24638V5.5415H13.4581H12.7081H7.29142H6.54142H5.12516V8.24638V13.2464V16.2082C5.12516 16.6224 5.46095 16.9582 5.87516 16.9582H14.1252C14.5394 16.9582 14.8752 16.6224 14.8752 16.2082V13.2464ZM8.04142 4.0415H11.9581V3.7915C11.9581 3.37729 11.6223 3.0415 11.2081 3.0415H8.79142C8.37721 3.0415 8.04142 3.37729 8.04142 3.7915V4.0415ZM8.3335 7.99984C8.74771 7.99984 9.0835 8.33562 9.0835 8.74984V13.7498C9.0835 14.1641 8.74771 14.4998 8.3335 14.4998C7.91928 14.4998 7.5835 14.1641 7.5835 13.7498V8.74984C7.5835 8.33562 7.91928 7.99984 8.3335 7.99984ZM12.4168 8.74984C12.4168 8.33562 12.081 7.99984 11.6668 7.99984C11.2526 7.99984 10.9168 8.33562 10.9168 8.74984V13.7498C10.9168 14.1641 11.2526 14.4998 11.6668 14.4998C12.081 14.4998 12.4168 14.1641 12.4168 13.7498V8.74984Z"
                                            fill="currentColor">
                                        </path>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                        } @empty {
                        <tr>
                            <td class="empty" colspan="12">Nenhuma consulta encontrada.</td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Paginação -->
            <div class="pagination">
                <span>Página {{ paginaAtual }} de {{ totalPaginas }}</span>
                <div class="pager-buttons">
                    <button class="btn btn-light" (click)="anterior()" [disabled]="paginaAtual === 1">Anterior</button>
                    <button class="btn btn-light" (click)="proxima()"
                        [disabled]="paginaAtual === totalPaginas">Próxima</button>
                </div>
            </div>
            }

        </div>

    </div>
</div>